Options -Indexes

<FilesMatch "^(\.htaccess|\.env)$">
    Require all denied
</FilesMatch>

# Restrict Nextcloud sync script to specific IPs only
<Files "sync-to-nextcloud.php">
    Require all denied
    Require ip 127.0.0.1 80.241.214.103
</Files>

# Deny direct access to cached images; must be served via img.php
<FilesMatch "^img/.*\.(jpg|jpeg|png|gif|webp|bmp)$">
    Require all denied
</FilesMatch>

# token.php is included server-side only
<Files "token.php">
    Require all denied
</Files>

# Security headers
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Permissions-Policy "accelerometer=(), camera=(), geolocation=(), microphone=(), payment=(), usb=()"
    Header always set Content-Security-Policy "default-src 'self'; img-src 'self' data: blob:; script-src 'self'; style-src 'self'; object-src 'none'; base-uri 'self'; frame-ancestors 'self'"
    # Only send HSTS on HTTPS
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" env=HTTPS
</IfModule>
